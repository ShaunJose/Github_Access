<!DOCTYPE html>
<!-- Network/Graph Visualizations (SEE README.md)-->

<html lang = "en">
<head>

    <title> d3 Network Visualizations </title>

    <!-- meta info -->
    <meta charset="uft-8">
    <meta name = "description" content = "Network Visualizations (see README)">
    <meta name = "author" content = "Shaun Jose">

    <!-- refresh document every 10 minutes -->
    <meta http-equiv="refresh" content="3000 ">

</head>

<body>

<!-- create a canvas for the graph -->
<canvas id="graph" width="0" height="0" style="border: 2px solid black;"> </canvas>

<!--Create spacing element. Used for spacing b/w graph and info -->
<canvas id="spacing" width="0" height="0"></canvas>

<!-- create a canvas for the user's information -->
<canvas id="info" width="0" height="0" style="border: 2px solid black;"> </canvas>

<!-- import d3.v5..min.js -->
<script src = "https://d3js.org/d3.v5.min.js"> </script>

<!-- do the real stuff -->
<script>

//CONSTANTS DECLARATION
//setting width of information bar and height gap for formatting
var INFO_WIDTH = 500;
var INFO_HEIGHT = 400;
var X_BORDER = 100;
var Y_BORDER = 100;
var REPEL_FORCE = -300; //force with which nodes repel (for spacing)

//set up width and height for the graph canvas declared before
canvas = document.getElementById("graph");
canvas.width = window.innerWidth - (INFO_WIDTH + X_BORDER);
canvas.height = window.innerHeight - Y_BORDER;

//set up width for the spacing canvas declared before
var canvas = document.getElementById("spacing");
canvas.width = X_BORDER - 50; //to allow space for info canvas as well

//set up width and height for the info canvas declared before
var canvas = document.getElementById("info");
canvas.width = INFO_WIDTH;
canvas.height = INFO_HEIGHT;

//put heading in Information
var context = canvas.getContext("2d");
context.font = "small-caps 30px Courier"
context.fillStyle = "blue"
context.fillText("User Information:", 25, 25,);

// //making dummy graph
// var graph = {
//     nodes: [ {
//         username: "One",
//         popularity: 1,
//         followers: 100,
//         location: "Boston"
//     },
//     {
//         username: "Two",
//         popularity: 2,
//         followers: 200,
//         location: "LA"
//     },
//     {
//         username: "Three",
//         popularity: 3,
//         followers: 300,
//         location: "Malaysia"
//     },
//     {
//         username: "Four",
//         popularity: 4,
//         followers: 400,
//         location: "Vegas"
//     } ],
//
//     links: [
//             { source: "One", target: "Two" },
//             { source: "One", target: "Three" },
//             { source: "Four", target: "Two" },
//             { source: "Three", target: "Two" }
//         ]
// };


//create the container (canvas) where you're drawing your network, and declare attributes
var container = d3.select("#graph");
var height = container.attr("height");
var width = container.attr("width");
var radius = 5;
context = container.node().getContext("2d");//TODO: WEBGL WORKS?

//create simulation object
var sim = d3.forceSimulation();

//do cool stuff with simulation
sim.force("y", d3.forceY(height/2)); //put nodes in the center of container horizontally
sim.force("x", d3.forceX(width/2)); //put nodes in the center of container vertically
sim.force("collide", d3.forceCollide(radius)); //nodes don't overlap
sim.force("charge", d3.forceManyBody().strength(REPEL_FORCE)); //space out nodes
sim.force("linkForce", d3.forceLink().id(function (node) { return node.username; } )); //create a link force, and look at username to find source and target nodes

//loading in data grabbed using Github_Access.py
d3.json("data.json", function (err, graph) {
    if (err) throw err;

    sim.nodes(graph.nodes); //perform a simulation on our nodes
    sim.on("tick", drawGraph); //call drawGraph everytime graph.nodes has new values
    sim.force("linkForce").links(graph.links); //assign the linkForce to graph.links.


    /**
      * Draws the graph's nodes and edges
      * NOTE: This function needs to be inside the json function as it uses variable graph
      **/
    function drawGraph(){

        context.clearRect(0, 0, width, height);

        //draw each node
        context.beginPath(); //signal that we're drawing stuff
        graph.nodes.forEach(drawNode); //draw all nodes
        context.fill(); //actually display stuff that's been created

        //draw each link
        context.beginPath(); //signal that we're drawing stuff
        graph.links.forEach(drawLink); //draw all links
        context.stroke(); //adisplay the strokes
    }

});

/**
  * Draws a node
  *
  * @param node: a node element (one user)
  **/
function drawNode(node){

    //set context on node
    context.moveTo(node.x, node.y);
    //draw the node as a circle
    context.arc(node.x, node.y, radius, 0, Math.PI * 2);
}

/**
  * Draws a link from a source node to a target node
  *
  * @param node: a node element (one user)
  **/
function drawLink(link){

    //move cursor to source node's position
    context.moveTo(link.source.x, link.source.y);
    //draw a line to the target node's location
    context.lineTo(link.target.x, link.target.y);
}

drawGraph();


</script>

</body>

</html>
